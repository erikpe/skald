// stdlib: vec_i64

extern fn print_i64(x: i64) -> unit;
extern fn print_u64(x: u64) -> unit;
extern fn print_bool(x: bool) -> unit;

fn test_basic_vec_ops() -> unit {
  var v: VecI64 = vec_i64_new();
  defer vec_i64_destroy(&v);

  print_u64(vec_i64_len(&v));

  print_bool(vec_i64_reserve(&v, 3));
  print_u64(v.cap);

  print_bool(vec_i64_push(&v, 10));
  print_bool(vec_i64_push(&v, 20));
  print_bool(vec_i64_push(&v, 30));
  print_u64(vec_i64_len(&v));

  var x: i64 = 0;
  print_bool(vec_i64_get(&v, 1, &x));
  print_i64(x);

  print_bool(vec_i64_set(&v, 1, 99));
  print_bool(vec_i64_get(&v, 1, &x));
  print_i64(x);

  print_bool(vec_i64_pop(&v, &x));
  print_i64(x);
  print_u64(vec_i64_len(&v));

  print_bool(vec_i64_pop(&v, &x));
  print_i64(x);
  print_u64(vec_i64_len(&v));

  vec_i64_clear(&v);
  print_u64(vec_i64_len(&v));

  print_bool(vec_i64_reserve(&v, 1));
  print_u64(v.cap);

  print_bool(vec_i64_get(&v, 0, &x));
  print_bool(vec_i64_pop(&v, &x));
}

fn test_large_vec_sum_1_to_1000() -> unit {
  var v: VecI64 = vec_i64_new();
  defer vec_i64_destroy(&v);

  var i: u64 = 1;
  while i <= 1000 {
    if !vec_i64_push(&v, i as i64) {
      print_bool(false);
      return;
    }
    i = i + 1;
  }

  print_bool(true);
  print_u64(vec_i64_len(&v));

  var sum: i64 = 0;
  var x: i64 = 0;
  i = 0;
  while i < vec_i64_len(&v) {
    if !vec_i64_get(&v, i, &x) {
      print_bool(false);
      return;
    }
    sum = sum + x;
    i = i + 1;
  }

  print_bool(true);
  print_i64(sum);
}

fn test_panic_wrappers_happy_path() -> unit {
  var v: VecI64 = vec_i64_new();
  defer vec_i64_destroy(&v);

  vec_i64_push_or_panic(&v, 11);
  vec_i64_push_or_panic(&v, 22);
  vec_i64_push_or_panic(&v, 33);

  print_i64(vec_i64_get_or_panic(&v, 0));
  print_i64(vec_i64_get_or_panic(&v, 2));

  vec_i64_set_or_panic(&v, 1, 99);
  print_i64(vec_i64_get_or_panic(&v, 1));

  print_i64(vec_i64_pop_or_panic(&v));
  print_u64(vec_i64_len(&v));
}

fn main() -> i64 {
  test_basic_vec_ops();
  test_large_vec_sum_1_to_1000();
  test_panic_wrappers_happy_path();

  return 0;
}
